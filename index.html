<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spektra Install Italy ‚Äì Gener√°tor Pon√∫k v3.5 (Tarvisio Edition)</title>
    
    <link rel="icon" href="data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23D60000'/%3E%3Ctext x='32' y='47' fill='white' font-family='sans-serif' font-weight='900' font-size='44' text-anchor='middle'%3ES%3C/text%3E%3C/svg%3E">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&subset=latin,latin-ext&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #D60000;
            --primary-dark: #a50000;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-700: #374151;
            --gray-900: #111827;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            background-color: var(--gray-100);
            font-family: 'Roboto', Arial, Helvetica, sans-serif;
            margin: 0;
            padding: 0;
            color: var(--gray-900);
            line-height: 1.35;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            display: grid;
            grid-template-columns: 420px 1fr;
            gap: 24px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            height: 100vh;
            box-sizing: border-box;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            height: calc(100vh - 48px);
        }

        .controls h2 { margin: 0 0 8px 0; font-size: 16px; color: var(--gray-900); display: flex; align-items: center; gap: 8px; }
        .controls h2::before { content:''; display:block; width: 10px; height: 10px; background: var(--primary); border-radius: 50%; }

        .form-group { display: flex; flex-direction: column; gap: 4px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        label { font-size: 10px; font-weight: 700; color: var(--gray-700); text-transform: uppercase; letter-spacing: 0.03em; }
        
        input, select, textarea {
            padding: 6px 8px;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-family: inherit;
            font-size: 12px;
            transition: border-color 0.2s;
            background: #fff;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); }
        
        .btn-group { margin-top: auto; display: flex; gap: 8px; flex-wrap: wrap; }
        
        button {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }
        .btn-primary { background: var(--primary); color: white; flex: 2; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: var(--gray-200); color: var(--gray-900); flex: 1; }

        .preview-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow-y: auto;
            background: #dbeafe;
            border-radius: 16px;
            padding: 20px;
        }

        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            padding: 10mm 15mm; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .header { display: flex; justify-content: space-between; border-bottom: 2px solid var(--primary); padding-bottom: 5px; margin-bottom: 10px; }
        .logo-placeholder { font-size: 22px; font-weight: 900; color: var(--primary); letter-spacing: -0.5px; line-height: 1; }
        .logo-placeholder span { color: var(--gray-900); }
        
        .addresses { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; }
        .addr-box h3 { font-size: 9px; text-transform: uppercase; color: var(--gray-500); border-bottom: 1px solid var(--gray-200); padding-bottom: 2px; margin-bottom: 4px; }
        .addr-box p { margin: 0; font-size: 11px; font-weight: 400; }
        .addr-box .highlight { font-weight: 700; font-size: 12px; }

        .pricing-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 11px; }
        .pricing-table th { background: var(--gray-100); text-align: left; padding: 4px 6px; font-weight: 700; border-bottom: 2px solid var(--gray-200); }
        .pricing-table td { padding: 3px 6px; border-bottom: 1px solid var(--gray-200); }
        .num { text-align: right; white-space: nowrap; }

        .totals { display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .totals-box { width: 220px; }
        .t-row { display: flex; justify-content: space-between; padding: 2px 0; font-size: 11px; }
        .t-row.grand { border-top: 2px solid var(--gray-900); margin-top: 4px; padding-top: 4px; font-weight: 800; font-size: 14px; color: var(--primary); }

        .subsidy-box { margin-top: 5px; padding: 8px; border: 1px dashed var(--primary); border-radius: 6px; background-color: #fffafa; }
        .subsidy-box h4 { margin: 0 0 2px 0; color: var(--primary); font-size: 11px; text-transform: uppercase; }

        .notes-section { margin-top: 15px; font-size: 10px; color: var(--gray-700); border-top: 2px solid var(--gray-200); padding-top: 8px; }

        @media print {
            .controls { display: none !important; }
            .preview-container { background: white; padding: 0; overflow: visible; }
            .a4-page { width: 100%; box-shadow: none; margin: 0; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <section class="controls">
        <h2>Configurazione Offerta IT</h2>
        <div class="form-row">
            <div class="form-group"><label>Nr. Preventivo</label><input type="text" id="inp-no" value="OF-2026-TR01"></div>
            <div class="form-group"><label>Data</label><input type="date" id="inp-date"></div>
        </div>
        <div class="form-group"><label>Cliente</label><input type="text" id="inp-name" placeholder="Nome Cognome"></div>
        <div class="form-group"><label>Indirizzo (Tarvisio)</label><textarea id="inp-addr" rows="2" placeholder="Via Romana..."></textarea></div>

        <hr style="border:0; border-top:1px solid #eee;">

        <div class="form-group">
            <label>Sistema (Mitsubishi Zubadan / Panasonic T-CAP)</label>
            <select id="inp-model">
                <optgroup label="Mitsubishi Zubadan (Ideale per radiatori)">
                    <option value="zuba_aio_8">Mitsubishi Zubadan 8kW + AiO 200L</option>
                    <option value="zuba_aio_12">Mitsubishi Zubadan 12kW + AiO 200L</option>
                </optgroup>
                <optgroup label="Panasonic T-CAP (Potenza costante a -15¬∞C)">
                    <option value="pana_tcap_9">Panasonic T-CAP 9kW + AiO 185L</option>
                    <option value="pana_tcap_12">Panasonic T-CAP 12kW + AiO 185L</option>
                </optgroup>
            </select>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Detrazione Fiscale</label>
                <select id="inp-voucher">
                    <option value="0.65">Ecobonus 65% (Detrazione)</option>
                    <option value="0.50">Bonus Casa 50%</option>
                    <option value="4400">Conto Termico 2.0 (Rimborso)</option>
                </select>
            </div>
            <div class="form-group">
                <label>IVA Italia (%)</label>
                <select id="inp-vat">
                    <option value="10" selected>10 % (Agevolata IT)</option>
                    <option value="22">22 % (Standard IT)</option>
                </select>
            </div>
        </div>

        <div class="form-group"><label>Sconto (‚Ç¨)</label><input type="number" id="inp-discount" value="0"></div>
        <div class="form-group"><label>Nota</label><textarea id="inp-note" placeholder="Note specifiche per il cantiere..."></textarea></div>

        <div class="btn-group">
            <button class="btn-primary" onclick="window.print()">üñ®Ô∏è Stampa PDF</button>
            <button class="btn-secondary" onclick="saveLocal()">üíæ Salva</button>
        </div>
    </section>

    <section class="preview-container">
        <div class="a4-page" id="document">
            <div class="header">
                <div class="logo-area">
                    <div class="logo-placeholder">SPEKTRA <span>INSTALL</span></div>
                    <div style="font-size:10px; color:#666; margin-top:4px;">Impianti Termici Professionali - Tarvisio (UD)</div>
                </div>
                <div style="text-align:right;">
                    <h1 style="font-size:16px; margin:0;">PREVENTIVO</h1>
                    <div style="font-size:10px;">Nr: <strong id="out-no"></strong> | Data: <strong id="out-date"></strong></div>
                </div>
            </div>

            <div class="addresses">
                <div class="addr-box">
                    <h3>Fornitore</h3>
                    <p class="highlight">Spektra Install s. r. o.</p>
                    <p>Sede Operativa: Tarvisio (UD)</p>
                    <p>P.IVA Intracom: SK53690036</p>
                </div>
                <div class="addr-box">
                    <h3>Destinatario</h3>
                    <p class="highlight" id="out-name"></p>
                    <p id="out-addr" style="white-space: pre-line;"></p>
                </div>
            </div>

            <div style="font-size:11px; margin-bottom:10px;">
                Oggetto: Proposta tecnico-commerciale per installazione sistema pompa di calore <strong>Split</strong>.
            </div>

            <table class="pricing-table">
                <thead>
                    <tr>
                        <th style="width: 55%">Descrizione</th>
                        <th class="num">Prezzo (IVA escl.)</th>
                        <th class="num">IVA</th>
                        <th class="num">Totale</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>

            <div class="totals">
                <div class="totals-box">
                    <div class="t-row"><span>Totale Imponibile:</span> <span id="t-net"></span></div>
                    <div class="t-row"><span>IVA:</span> <span id="t-vat"></span></div>
                    <div class="t-row grand"><span>TOTALE DOVUTO:</span> <span id="t-grand"></span></div>
                </div>
            </div>

            <div id="subsidy-section" class="subsidy-box">
                <h4>Incentivi Fiscali (Stima Zona F)</h4>
                <div class="t-row" style="font-size:11px;">
                    <span id="sub-label">Recupero stimato:</span>
                    <span id="sub-val" style="color:var(--primary); font-weight:700"></span>
                </div>
            </div>

            <div class="notes-section">
                <strong>NOTE TECNICHE:</strong><br>
                1. Collegamento tramite tubazioni frigorifere isolate (Sistema Split) - nessun rischio gelo esterno.<br>
                2. Installazione conforme alle normative F-GAS e collaudo incluso.<br>
                3. Garanzia Mitsubishi/Panasonic: 5 anni sul compressore.
            </div>

            <div style="margin-top:auto; display:flex; justify-content:space-between; font-size:10px;">
                <div>Vypracoval: <strong>Pavol Pastorek</strong></div>
                <div style="border-top:1px solid #000; width:150px; text-align:center; padding-top:5px;">Firma per accettazione</div>
            </div>
        </div>
    </section>
</div>

<script>
    const PRICES = {
        models: {
            'zuba_aio_8': { name: 'Mitsubishi Zubadan 8kW Split + Tower 200L', price: 11200 },
            'zuba_aio_12': { name: 'Mitsubishi Zubadan 12kW Split + Tower 200L', price: 12900 },
            'pana_tcap_9': { name: 'Panasonic T-CAP 9kW Split + AiO 185L', price: 10400 },
            'pana_tcap_12': { name: 'Panasonic T-CAP 12kW Split + AiO 185L', price: 12100 }
        },
        work: [
            { name: "Materiale installazione (Rame isolato, staffe, raccordi)", price: 1250 },
            { name: "Montaggio, collegamento idraulico e avviamento", price: 1450 },
            { name: "Trasporto e logistica Tarvisio", price: 250 }
        ]
    };

    function render() {
        const modelKey = document.getElementById('inp-model').value;
        const model = PRICES.models[modelKey];
        const vatRate = parseFloat(document.getElementById('inp-vat').value) / 100;
        const discount = parseFloat(document.getElementById('inp-discount').value) || 0;
        const voucher = document.getElementById('inp-voucher').value;

        document.getElementById('out-no').textContent = document.getElementById('inp-no').value;
        document.getElementById('out-date').textContent = document.getElementById('inp-date').value;
        document.getElementById('out-name').textContent = document.getElementById('inp-name').value;
        document.getElementById('out-addr').textContent = document.getElementById('inp-addr').value;

        let html = '';
        let totalNet = model.price;

        // Model row
        html += `<tr><td>${model.name}</td><td class="num">‚Ç¨ ${(model.price / (1+vatRate)).toFixed(2)}</td><td class="num">‚Ç¨ ${(model.price * vatRate / (1+vatRate)).toFixed(2)}</td><td class="num">‚Ç¨ ${model.price.toFixed(2)}</td></tr>`;
        
        // Work rows
        PRICES.work.forEach(w => {
            totalNet += w.price;
            html += `<tr><td>${w.name}</td><td class="num">‚Ç¨ ${(w.price / (1+vatRate)).toFixed(2)}</td><td class="num">‚Ç¨ ${(w.price * vatRate / (1+vatRate)).toFixed(2)}</td><td class="num">‚Ç¨ ${w.price.toFixed(2)}</td></tr>`;
        });

        document.getElementById('table-body').innerHTML = html;

        const grandTotal = Math.max(0, totalNet - discount);
        const vatTotal = grandTotal * (vatRate / (1 + vatRate));
        const netTotal = grandTotal - vatTotal;

        document.getElementById('t-net').textContent = `‚Ç¨ ${netTotal.toLocaleString('it-IT', {minimumFractionDigits:2})}`;
        document.getElementById('t-vat').textContent = `‚Ç¨ ${vatTotal.toLocaleString('it-IT', {minimumFractionDigits:2})}`;
        document.getElementById('t-grand').textContent = `‚Ç¨ ${grandTotal.toLocaleString('it-IT', {minimumFractionDigits:2})}`;

        // Bonus logic
        let bonusVal = 0;
        if(voucher === "4400") bonusVal = 4400;
        else bonusVal = grandTotal * parseFloat(voucher);
        document.getElementById('sub-val').textContent = `‚Ç¨ ${bonusVal.toLocaleString('it-IT', {minimumFractionDigits:2})}`;
    }

    document.querySelectorAll('input, select, textarea').forEach(el => el.addEventListener('input', render));
    document.getElementById('inp-date').value = new Date().toISOString().split('T')[0];
    render();
</script>
</body>
</html>
